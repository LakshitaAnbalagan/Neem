<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat – Neem Sourcing</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/theme.css" rel="stylesheet">
  <style>
    .chat-layout { display: grid; grid-template-columns: 17.5rem 1fr; min-height: calc(100vh - var(--navbar-height, 3.75rem)); }
    .chat-sidebar { border-right: 1px solid var(--border); background: var(--bg-card); overflow-y: auto; }
    .chat-main { display: flex; flex-direction: column; background: var(--bg); }
    .chat-header { padding: 1rem; border-bottom: 1px solid var(--border); background: var(--bg-card); }
    .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; }
    .chat-input-wrap { padding: 1rem; border-top: 1px solid var(--border); background: var(--bg-card); }
    .chat-input-row { display: flex; gap: 0.5rem; align-items: flex-end; }
    .chat-input-row textarea { flex: 1; min-height: 2.75rem; max-height: 7.5rem; resize: none; }
    .conv-item { padding: 0.85rem 1rem; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.15s; }
    .conv-item:hover, .conv-item.active { background: rgba(13, 92, 46, 0.08); }
    .conv-item .name { font-weight: 600; }
    .conv-item .preview { font-size: 0.8rem; color: var(--text-muted); }
    .conv-item-bot { border-left: 0.1875rem solid var(--primary); }
    .conv-item-bot .preview.text-primary { color: var(--primary) !important; }
    .chat-bubble.bot { background: linear-gradient(135deg, rgba(13,92,46,0.12) 0%, rgba(13,92,46,0.06) 100%); border: 1px solid rgba(13,92,46,0.2); border-bottom-left-radius: 0.25rem; }
    .chat-bubble.bot .time { font-size: 0.7rem; opacity: 0.85; margin-top: 0.25rem; }
    .chat-bubble.typing { min-height: 2.5rem; display: flex; align-items: center; }
    .chat-bubble.typing .typing-dots { display: inline-block; animation: typingPulse 1s ease-in-out infinite; margin-right: 0.15rem; }
    @keyframes typingPulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
    @media (max-width: 48rem) { .chat-layout { grid-template-columns: 1fr; } .chat-sidebar { max-height: 12.5rem; } }
  </style>
</head>
<body>
  <nav class="navbar">
    <a class="navbar-brand" href="#" id="navBrand">Neem Sourcing</a>
    <div class="nav-links">
      <a href="products.html" id="navProducts">Products</a>
      <a href="map.html" id="navMap">Map</a>
      <a href="chat.html">Chat</a>
      <a href="#" id="navDashboard">Dashboard</a>
      <button type="button" class="btn btn-outline btn-sm" id="logoutBtn">Log out</button>
    </div>
  </nav>

  <div class="chat-layout">
    <div class="chat-sidebar">
      <div class="p-2 border-bottom border-end" style="background: var(--bg);">
        <strong>Conversations</strong>
      </div>
      <div class="conv-item conv-item-bot d-flex align-center gap-2" id="botConvItem" title="Ask about sourcing, availability, trust scores, and more">
        <span class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width:2.25rem;height:2.25rem;font-size:0.9rem;">★</span>
        <div>
          <div class="name">Neem Assistant</div>
          <div class="preview text-primary">Guidance &amp; common queries</div>
        </div>
      </div>
      <div id="convList"></div>
    </div>
    <div class="chat-main">
      <div class="chat-header d-flex align-center justify-between" id="chatHeader">
        <span class="text-muted" id="chatHeaderText">Select a conversation or start from Products</span>
      </div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input-wrap hide" id="chatInputWrap">
        <div class="chat-input-row">
          <button type="button" class="voice-btn" id="voiceBtn" title="Voice input">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>
          </button>
          <textarea class="form-control" id="messageInput" placeholder="Type a message or use voice…" rows="1"></textarea>
          <button type="button" class="btn btn-primary" id="sendBtn">Send</button>
        </div>
        <div class="d-flex flex-wrap gap-1 mt-2" id="quickPrompts">
          <span class="text-small text-muted">Quick:</span>
          <button type="button" class="btn btn-sm btn-outline" data-msg="What is your current availability?">Availability</button>
          <button type="button" class="btn btn-sm btn-outline" data-msg="What is the best price for bulk order?">Bulk price</button>
          <button type="button" class="btn btn-sm btn-outline" data-msg="When can you deliver?">Delivery</button>
        </div>
        <p class="text-small text-muted mt-2 mb-0" id="voiceStatus"></p>
      </div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script src="js/app.js"></script>
  <script src="js/chatbot.js"></script>
  <script src="js/voice.js"></script>
  <script src="js/chat.js"></script>
</body>
</html>
